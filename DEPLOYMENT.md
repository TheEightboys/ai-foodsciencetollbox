# Deployment Guide - Vercel (Frontend) + Render (Backend)

## Frontend → Vercel (ai.foodsciencetoolbox.com)

### 1. Connect to Vercel
1. Go to https://vercel.com and sign in with GitHub
2. Click "New Project" → Import your repository
3. Vercel auto-detects Vite configuration

### 2. Configure Environment Variables
Add in Vercel Project Settings → Environment Variables:
```
VITE_API_BASE_URL=https://api.foodsciencetoolbox.com
```

### 3. Configure Custom Domain
1. In Vercel Project Settings → Domains
2. Add domain: `ai.foodsciencetoolbox.com`
3. Vercel will provide DNS records (CNAME or A record)
4. Add those records in your domain DNS settings
5. Vercel auto-provisions SSL/TLS certificate

### 4. Deploy
- Push to `main` branch → auto-deploys
- Or click "Deploy" in Vercel dashboard

---

## Backend → Render (api.foodsciencetoolbox.com)

### 1. Connect to Render
1. Go to https://render.com and sign in with GitHub
2. Click "New +" → "Web Service"
3. Connect your repository
4. Render auto-detects `Backend/render.yaml`

### 2. Configure Service
Render will use settings from `Backend/render.yaml`, but you need to:
- Set **Root Directory** to `Backend`
- Confirm Docker detection (uses `Backend/Dockerfile`)

### 3. Add Managed Postgres (required)
1. In Render Dashboard → "New +" → "PostgreSQL"
2. Create database (Free tier available)
3. After creation, go to Web Service → Environment
4. Add environment variable:
   ```
   DATABASE_URL = [paste internal connection string from Postgres]
   ```

### 4. Add Required Environment Variables
In Render Web Service → Environment, add:

**Required (add manually):**
```
OPENAI_API_KEY=sk-...
STRIPE_SECRET_KEY=sk_test_... or sk_live_...
STRIPE_PUBLISHABLE_KEY=pk_test_... or pk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...
```

**Auto-configured (already in render.yaml):**
- `DJANGO_SETTINGS_MODULE=config.settings.production`
- `SECRET_KEY` (auto-generated by Render)
- `DEBUG=False`
- `ALLOWED_HOSTS=api.foodsciencetoolbox.com`
- `CORS_ALLOWED_ORIGINS=https://ai.foodsciencetoolbox.com`

### 5. Configure Custom Domain
1. In Render Web Service → Settings → Custom Domains
2. Add: `api.foodsciencetoolbox.com`
3. Render provides a CNAME target (e.g., `abc123.onrender.com`)
4. Add CNAME record in your DNS:
   ```
   Type: CNAME
   Name: api
   Value: abc123.onrender.com
   ```
5. Render auto-provisions SSL/TLS certificate

### 6. Deploy
- Push to `main` → auto-deploys
- Or click "Manual Deploy" in Render dashboard
- Check logs in Render dashboard

---

## DNS Configuration Summary

### For Vercel (Frontend - ai.foodsciencetoolbox.com)
```
Type: CNAME (or A if Vercel specifies)
Name: ai
Value: [provided by Vercel]
```

### For Render (Backend - api.foodsciencetoolbox.com)
```
Type: CNAME
Name: api
Value: [provided by Render, e.g., your-service.onrender.com]
```

---

## Verification

### Frontend
```bash
curl -I https://ai.foodsciencetoolbox.com
# Should return 200 OK with HTML
```

### Backend
```bash
curl -I https://api.foodsciencetoolbox.com/api/health/
# Should return 200 OK
```

### CORS Check
```bash
curl -H "Origin: https://ai.foodsciencetoolbox.com" -I https://api.foodsciencetoolbox.com/
# Should include Access-Control-Allow-Origin header
```

---

## Troubleshooting

### Frontend Issues
- **Build fails**: Check Node version in Vercel (should use 20.x)
- **Routes return 404**: `vercel.json` rewrites should handle this
- **API calls fail**: Check `VITE_API_BASE_URL` environment variable

### Backend Issues
- **500 errors**: Check Render logs for Django errors
- **Database errors**: Verify `DATABASE_URL` is set correctly
- **CORS errors**: Verify `CORS_ALLOWED_ORIGINS` includes frontend URL
- **Static files missing**: Check `start.sh` runs `collectstatic`

### DNS Issues
- Wait 5-60 minutes for DNS propagation
- Use `dig ai.foodsciencetoolbox.com` to verify DNS records
- Check SSL status in Vercel/Render dashboards

---

## Cost Estimate

### Vercel
- Free tier: Unlimited personal projects
- Pro ($20/month): For production use

### Render
- Free tier: Available (with limitations - sleeps after inactivity)
- Starter ($7/month): Recommended for production
- Postgres Free tier: 90-day limit, then $7/month

**Recommended production setup:** ~$14-27/month (Vercel Pro + Render Starter + Postgres)
